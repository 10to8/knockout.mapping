// Knockout Mapping plugin v0.5
// (c) 2010 Steven Sanderson, Roy Jacobs - http://knockoutjs.com/
// License: Ms-Pl (http://www.opensource.org/licenses/ms-pl.html)

ko.d=function(s,l){for(var i=s.split("."),m=window,q=0;q<i.length-1;q++)m=m[i[q]];m[i[i.length-1]]=l};ko.B=function(s,l,i){s[l]=i};
(function(){function s(){ko.l=function(a,c,b){b=b||{};b.A=true;a=new u(a,c,b);a.q=u;y.push(a);return a}}function l(a){if(a&&typeof a==="object"&&a.constructor==(new Date).constructor)return"date";return typeof a}function i(a,c,b){v||(y=[]);v++;a=m(a,c,b);v--;v||ko.b.h(a,function(d){d&&d.q==u&&d.evaluate();return d});return a}function m(a,c,b,d,e,j){var g=ko.a.c(c)instanceof Array;if(ko.b.n(a))b=ko.a.c(a)[n];d=d||new z;if(d.i(c))return a;e=e||"";if(g){ko.C(a)||(a=ko.G([]));g=[];var f=function(h){return h};
if(b[e]&&b[e].key)f=b[e].key;var o=A(ko.a.c(a),f).sort(),t=A(c,f).sort();o=ko.a.z(o,t);t=[];for(var x=0,D=o.length;x<D;x++){var r=o[x];switch(r.status){case "added":var k=w(ko.a.c(c),r.value,f),p=ko.a.c(m(undefined,k,b,d,e,j));k=ko.a.g(ko.a.c(c),k);t[k]=p;break;case "retained":k=w(ko.a.c(c),r.value,f);p=w(a,r.value,f);m(p,k,b,d,e,j);k=ko.a.g(ko.a.c(c),k);t[k]=p;break;case "deleted":p=w(a,r.value,f);a.remove(p)}g.push({event:r.status,item:p})}a(t);b[e]&&b[e].k&&ko.a.v(g,function(h){b[e].k(h.event,
h.item)})}else if(l(c)=="object"&&c!==null&&c!==undefined){if(!a)if(b[e]&&b[e].create instanceof Function){s();j=b[e].create(c,j);ko.l=u;return j}else a={};d.save(c,a);B(c,function(h){var C=d.i(c[h]);a[h]=C?C:m(a[h],c[h],b,d,h,a)})}else switch(l(c)){case "function":a=c;break;default:if(ko.D(a))a(ko.a.c(c));else a=ko.F(ko.a.c(c))}return a}function q(a,c){var b;if(c)b=c(a);b||(b=a);return ko.a.c(b)}function w(a,c,b){a=ko.a.u(ko.a.c(a),function(d){return q(d,b)==c});if(a.length!=1)throw Error("When calling ko.update*, the key '"+
c+"' was not found or not unique!");return a[0]}function A(a,c){return ko.a.w(ko.a.c(a),function(b){return c?q(b,c):b})}function B(a,c){if(a instanceof Array)for(var b=0;b<a.length;b++)c(b);else for(b in a)c(b)}function z(){var a=[],c=[];this.save=function(b,d){var e=ko.a.g(a,b);if(e>=0)c[e]=d;else{a.push(b);c.push(d)}};this.i=function(b){b=ko.a.g(a,b);return b>=0?c[b]:undefined}}ko.b={};var n="__ko_mapping__",v=0,u=ko.l,y;ko.b.m=function(a,c,b){if(arguments.length==0)throw Error("When calling ko.fromJS, pass the object you want to convert.");
var d=c;d=d||{};if(d.create instanceof Function||d.key instanceof Function||d.k instanceof Function)d={"":d};c=d;d=i(b,a,c);d[n]=d[n]||{};d[n]=c;return d};ko.b.r=function(a,c){var b=ko.a.s(a);return ko.b.m(b,c)};ko.b.n=function(a){return(a=ko.a.c(a))&&a[n]};ko.b.p=function(a,c){if(arguments.length<2)throw Error("When calling ko.updateFromJS, pass: the object to update and the object you want to update from.");if(!a)throw Error("The object is undefined.");if(!a[n])throw Error("The object you are trying to update was not created by a 'fromJS' or 'fromJSON' mapping.");
return i(a,c,a[n])};ko.b.t=function(a,c,b){c=ko.a.s(c);return ko.b.p(a,c,b)};ko.b.o=function(a,c){if(arguments.length==0)throw Error("When calling ko.mapping.toJS, pass the object you want to convert.");c=c||{};c.f=c.f||[];if(!(c.f instanceof Array))c.f=[c.f];return ko.b.h(a,function(b){return ko.a.c(b)},c)};ko.b.toJSON=function(a,c){var b=ko.b.o(a);return ko.a.H(b,c)};ko.b.h=function(a,c,b){b=b||{};b.j=b.j||new z;var d,e=ko.a.c(a);if(l(e)=="object"&&e!==null&&e!==undefined){c(a,b.e);d=e instanceof
Array?[]:{}}else return c(a,b.e);b.j.save(a,d);var j=b.e;B(e,function(g){if(!(b.f&&ko.a.g(b.f,g)!=-1)){var f=e[g];b.e=j||"";if(e instanceof Array){if(j)b.e+="["+g+"]"}else{if(j)b.e+=".";b.e+=g}switch(l(ko.a.c(f))){case "object":case "undefined":var o=b.j.i(f);d[g]=o!==undefined?o:ko.b.h(f,c,b);break;default:d[g]=c(f,b.e)}}});return d};ko.d("ko.mapping",ko.b);ko.d("ko.mapping.fromJS",ko.b.m);ko.d("ko.mapping.fromJSON",ko.b.r);ko.d("ko.mapping.isMapped",ko.b.n);ko.d("ko.mapping.toJS",ko.b.o);ko.d("ko.mapping.toJSON",
ko.b.toJSON);ko.d("ko.mapping.updateFromJS",ko.b.p);ko.d("ko.mapping.updateFromJSON",ko.b.t);ko.d("ko.mapping.visitModel",ko.b.h)})();
